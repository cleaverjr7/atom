parameters:
  atom_channel: dev
  atom_app: Atom Dev.app

steps:
- bash: |
    if [ -n "${SSH_PRIVATEKEY}" ]; then
      mkdir -p ${HOME}/.ssh/
      chmod 700 ${HOME}/.ssh/
      echo "github.com ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEAq2A7hRGmdnm9tUDbO9IDSwBK6TbQa+PXYPCPy6rbTrTtw7PHkccKrpp0yVhp5HdEIcKr6pLlVDBfOLX9QUsyCOV0wzfjIJNlGEYsdlLJizHhbn2mUjvSAHQqZETYP81eFzLQNnPHt4EVVUh7VfDESU84KezmD5QlWpXLmvU31/yMf+Se8xhHTvKSCZIFImWwoG6mbUoWf9nzpIoaSjB+weqqUUmpaaasXVal72J+UX2B+2RPW3RcT0eOzQgqlJL3RKrTJvdsjE3JEAvGq3lGHSZXy28G3skua2SmVi/w4yCE6gbODqnTWlg7+wC604ydGXA8VJiS5ap43JXiUFFAaQ==" >> ${HOME}/.ssh/known_hosts
      echo "${SSH_PRIVATEKEY}" > ${HOME}/.ssh/id_rsa
      chmod 600 ${HOME}/.ssh/id_rsa
    fi
    curl -s -L "https://atom.io/download/mac?channel=${ATOM_CHANNEL}" \
      -H 'Accept: application/octet-stream' \
      -o "atom.zip"
    mkdir -p /tmp/atom
    unzip -q atom.zip -d /tmp/atom
  displayName: install Atom
  env:
    ATOM_CHANNEL: ${{ parameters.atom_channel }}
    SSH_PRIVATEKEY: $(ssh.privateKey)
- bash: |
    "/tmp/atom/${ATOM_APP}/Contents/Resources/app/apm/bin/apm" ci
  displayName: install dependencies
  env:
    ATOM_APP: ${{ parameters.atom_app }}
