@import "ui-variables";
@import "octicon-mixins";
@import "tabs";

@icon-size: 30px;
@max-width: 250px;
@top-margin: @tab-height + @tab-top-padding + @tab-bottom-border-height;
@bottom-margin: @top-margin;

atom-messages {
  display: block;
  position: absolute;
  top: @top-margin;
  right: 0;
  bottom: @bottom-margin;
  max-width: @max-width;
  padding: @component-padding;
  font-size: 1.2em;
  overflow: auto;

  // -webkit-user-modify: read-write; // editable text during dev
}

atom-message {
  display: block;
  position: relative;
  padding: @component-padding;
  margin-bottom: 2px;
  border-radius: @component-border-radius;
  word-wrap: break-word;

  .detail {
    margin-top:  @component-padding/2;
    padding-top:  @component-padding/2;
    font-size: .8em;
    border-top: 1px solid hsla(0,0%,0%,.2);
  }

  &.icon:before {
    position: absolute;
    top: 12px;
    left: -@icon-size;
    bottom: 0;
    width: @icon-size;
    text-align: center;
  }

  &.has-close {
    padding-right: @component-padding + 24px; // space for icon
  }

  // TODO: might be better to create unique close buttons?
  .close {
    position: absolute;
    top: @component-padding;
    right: @component-padding;
    font-size: 16px;
    text-shadow: none;
    color: inherit;
    opacity: .3;
    &:hover, &:focus {
      opacity: 1;
      color: inherit;
    }
    &:active {
      opacity: .2;
    }
    &:before {
      margin: 0;
      color: inherit;
    }
  }

  .fatal-message {
    margin-top:  @component-padding/2;
    padding-top:  @component-padding/2;
    font-size: .8em;
    border-top: 1px solid hsla(0,0%,0%,.2);
  }

  .btn-toolbar {
    margin-top:  @component-padding/2;
  }

}

// Types -------------------------------

atom-message[type="fatal"],
atom-message[type="error"] {
  .message(@text-color-error; @background-color-error);
}

atom-message[type="warning"] {
  .message(@text-color-warning; @background-color-warning);
}

atom-message[type="info"] {
  .message(@text-color-info; @background-color-info);
}

atom-message[type="success"] {
  .message(@text-color-success; @background-color-success);
}


// Mixins -------------------------------

.message(@txt; @bg) {
  color: darken(@txt, 40%);
  border-left: @icon-size solid @bg;
  background-color: lighten(@bg, 25%);

  &.icon:before {
    color: lighten(@bg, 36%);
  }
}


// Animations -------------------------------

atom-message {
  -webkit-animation: message-show .16s cubic-bezier(0.175, 0.885, 0.32, 1.27499);
}

atom-message[type="fatal"] {
  -webkit-animation: message-show .16s cubic-bezier(0.175, 0.885, 0.32, 1.27499),
                     message-shake 4s 2s;
  -webkit-animation-iteration-count: 1, 3; // shake 3 times after showing
}

@-webkit-keyframes message-show {
    0% { opacity: 0; transform: perspective(@max-width) translateY(-20px) rotateX(90deg);  }
  100% { opacity: 1; transform: perspective(@max-width) translateY(0) rotateX(0deg); }
}

@-webkit-keyframes message-shake {
    0% { transform: translateX(   0); }
    2% { transform: translateX(-4px); }
    4% { transform: translateX( 8px); }
    6% { transform: translateX(-4px); }
    8% { transform: translateX(   0); }
  100% { transform: translateX(   0); }
}
